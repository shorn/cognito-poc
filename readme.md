This repo is for learning about Cognito and aws-cdk.

# Running you own infrastructure

## Pre-requisites

* AWS account ID/alias
  * preferrably, you should use a "sub-account" to play with stuff like this
  in
* AWS Access key to run the CDK with
  * Never use the "root account" of an AWS account to do stuff, follow these
    [instructions](./doc/create-iam-account.md) for creating an IAM account and
    access key
* Node/NPM available on the path

## Configure AWS credentials

Most people would run this project from a developer machine - in which case
you'll needed [set up credentials](./doc/aws-credentials.md) for the 
`cognito-poc` profile.

## Bootstrap the AWS-CDK and do initial deployment
* `cd <repo>/aws-infra`
* `npm run bootstrap`
  * this will create an S3bucket and other resources that aws-cdk uses to manage
  deployments
* `npm run deploy`
  * this will deploy all CDK stacks, note that the CloudFrontStack will deploy 
  any files from dir `<repo>/client/build` that were generated by the 
  client build, but there won't be anthing in there yet

## Configure Google dev console and Cognito Google credentials
* configure credentials and consent screen in Google dev console
* configure the Cognito Google pool with the credentials from Google dev console

## Configure the client app to know about our stack details
* populate [client Config.ts](./client/src/Config.ts) with the details for
the cognito user-pools
  * the current values in the source are for my test infrastructure, you need
  to change them over to point to your own infrastructure

## Build and deploy the client app
* `cd <repo>/client`
* `npm run build-prd`
  * this will build the client web app suitable for deploying to CloudFront
* `cd <repo>/aws-infra`
* `npm run deploy-cloudfront`
  * this will pick up the generated files from `<repo>/client/build`, upload
  them to the S3 bucket and clear the CloudFront cache

That's it - you should now be able to navigate to the URL for the app and 
sign in (look in the CloudFront console under "Distribution domain name").


